---
layout: post
title: 网络编程
author: jevon xiong
tags:
- blog
- 嵌入式
- Liunx
date: 2024-03-12 21:00 +0800
toc: true
---
# 网络编程（套接字编程）

## 基础

TCP/IP协议
特点：
不局限于某一台主机中的各个进程，只要网络可以到达，就可以实现跨平台的进程通信。
协议：
想要实现在两个或多个平台中稳定通信，就需要遵守（达成）同一个协议。

**TCP 协议**：
TCP协议包含两个方面

- tcp传输协议：用来检测网络传输中差错的传输控制协议
- ip 网际协议：专门负责对不同网络进行互联的互联网协议IP
  （通俗的来说TCP是专门负责传输过程中的出错问题，一旦出现传输的问题TCP协议则会介入处理，并把出错的数据包重新传输直到数据安全到达为止。而IP协议则是在网络中负责不同的网络之间的通信，给网络中的每一台主机分配一个不同的IP地址）

OSI 开放系统互连模型
OSI模型相关的协议已经非常少使用，但是模型本身非常通用
OSI模式是一个理想化的模型，至今尚未由完整的实现
OSI模型共分为7层：

物理层
负责如何把数据包通过网卡然后在网线中传输。包括所有硬件的
管理比如网卡/针脚/电压/集线器/中继器等等

1. 用户层
   1.1 应用层--提供给应用程序的接口，用以设置与另外一个程序之间的通信方式（例如：HTTP/HTTPS/FTP/SSH/SMTP/TELNET等...）
   1.2 表示层--根据系统把数据进行转换
   1.3 会话层--负责数据传输时的设置以及维护网络中两台计算机之间的通信连接
2. 内核层
   2.1 传输层--把需要传输的数据以及一些基本信息（传输表头TH--传输协议TCP等）一起打包形成数据包
   2.2 网络层--把上一层的数据包再加一个网络信息（网络表头NH--互联网协议IP等）形成分组。
3. 驱动层
   3.1 数据链路层--负责网络寻址、错误侦测与改正。当表头（DLH包含物理地址和错误侦测及修正方法）和表尾（DLT提示到达末尾的字符串）被添加到数据包中时就形成帧。
   3.2 物理层--负责如何把数据包通过网卡然后在网线中传输。包括所有硬件的管理比如网卡/针脚/电压/集线器/中继器等等

OSI参考模型并不是一个标准，而是一个在制定标准时所使用的概念性框架。

TCP / IP 模型 (协议簇)
TCP/IP协议事实上是一个工业标准。
TCP/IP协议指的是能够在多个不同的网络间实现信息传输的协议簇。
该协议并不是只由 TCP 和 IP协议组成，而是由FTP、SMTP、TCP、UDP、IP等协议构成的协议簇。只是TCP IP 协议比较有代表性所以被称为TCP/IP协议。
TCP/IP只有4层（应用层、传输层、网络层、网络接口和物理层）

自下而上了解TCP/IP协议：

- 网络接口和物理层
  物理层的主要设备就是中继器和集线器（交换机/路由）
  封装成帧（在数据的前后分别加上*开始《纠错以及修正》*和结束的标记后便构成了一*帧*）
  每一个数据链路层都规定了所能传输的一针数据中数据的长度上限称为*最大传输单元（MTU）*
  透明传输（指的是不管数据的二进制是如何组合都应该能够正常传输而不会被误以为是某些控制的命令，确保数据安全到达）
  差错检测（在传输的二进制编码中加入适当的冗余度使得接收者可以发现在传输中是否出现了差错）
  TCP /IP 协议的数据包组成：
  头部数据+最大传送单元+尾部数据

Socket --- 插座

- 是一个编程接口
- 是一个特殊的文件描述符
- 不仅仅局限于TCP/IP协议
- **面向连接 TCP（视频通话）**
- **无连接 UDP （发微信消息）**
- 很多的应用 都依赖于socket的接口例如FTP\TELNET等

为什么需要socket
      普通IO操作的过程：
          打开文件 >> 读/写操作 >> 关闭文件
Socket文件的操作：
    在同一个机器上的两个程序可以简单的通过某一个相同的文件进行数据的交流和传输

**什么是Socket**
-   独立于具体协议的网络编程接口
-   在OSI模型中主要位于会话层和传输层之间
-   Socket的类型
    -   流式套接字 （SOCK_STREAM） TCP
    提供一个面向连接、可靠的数据传输服务，**数据无差错、无重复、地发送并按顺序抵达**。内设流量控制，避免数据流淹没前面的数据。数据被查看时字节流，无长度限制。
    -   数据报套接字（SOCK_DGRAM） UDP
    提供无连接服务，数据包以独立数据包形式被发送，**不提供无差错保证，数据有可能丢失或重复到达，顺序发送可能会乱序接收**
    -   原始套接字（SOCK_RAW）
    可以直接访问较低层次的协议例如 IP\ICMP。
    